<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sector Rotation Radar</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Plotly.js for charting (updated version) -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(to right, #10B981, #3B82F6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Ensure the Plotly chart tooltip has a dark background */
        .plotly .hovertext {
            background-color: #1f2937 !important; /* bg-gray-800 */
            border-color: #4b5563 !important; /* border-gray-600 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <main>
        <!-- Hero Section -->
        <section id="home" class="pt-16 pb-12 md:pt-20 md:pb-16 text-center bg-gray-900">
            <div class="container mx-auto px-4 sm:px-6">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-white leading-tight">
                    Sector Rotation <span class="gradient-text">Radar</span>
                </h1>
                <p class="mt-6 text-lg md:text-xl text-gray-400 max-w-3xl mx-auto">
                    A visualization of U.S. stock market sectors, weighted by market capitalization and colored by relative strength.
                </p>
            </div>
        </section>

        <!-- Chart Section -->
        <section id="chart-section" class="py-12 bg-gray-800">
            <div class="container mx-auto px-4 max-w-7xl">
                <!-- The div where the Plotly chart will be rendered -->
                <div id="sector-treemap" class="w-full h-[70vh] bg-gray-900 rounded-lg shadow-lg"></div>

                <div class="mt-8 text-center text-gray-400 text-xs sm:text-sm">
                    <p><span class="font-bold text-gray-200">Tile Size:</span> Proportional to the sector's market weight.</p>
                    <p class="mt-1"><span class="font-bold text-gray-200">Tile Color:</span> Represents relative strength. <span class="text-green-400">Green</span> for strong, <span class="text-red-400">Red</span> for weak.</p>
                </div>
            </div>
        </section>

        <!-- Explanation Section -->
        <section id="explanation" class="py-16 md:py-20 bg-gray-900">
             <div class="container mx-auto px-4 sm:px-6 max-w-4xl text-left">
                 <h2 class="text-2xl md:text-3xl font-bold text-white">How It Works</h2>
                 <p class="mt-4 text-base md:text-lg text-gray-400 leading-relaxed">
                    This tool visualizes sector performance data. In the final version, this data will be generated by a daily automated script. For now, it uses built-in mock data for demonstration.
                 </p>
                 <ol class="mt-6 list-decimal list-inside space-y-4 text-gray-400 text-base md:text-lg">
                    <li><span class="font-semibold text-gray-200">Data Source:</span> Currently, the chart uses mock data defined directly in the HTML file. Later, this will be replaced by a `data.json` file.</li>
                    <li><span class="font-semibold text-gray-200">Visualization:</span> Plotly.js is used to render the data as the interactive treemap you see above. You can hover over any sector to see its specific metrics.</li>
                </ol>
             </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700">
        <div class="container mx-auto px-6 py-8 text-center text-gray-400">
            <a href="https://KaChing-Labs.com" class="text-lg font-semibold text-white">KaChing <span class="text-emerald-400">Labs</span></a>
            <p class="mt-2 text-sm">Intelligent tools for your financial journey.</p>
            <p id="copyright" class="mt-4 text-xs">&copy; 2025 KaChing Labs. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // --- Plotly Chart Generation ---

        // Function to create the plot using mock data
        function createTreemap() {
            try {
                // --- Mock Data ---
                const sectorData = [
                    { "sector": "Information Technology", "market_weight": 0.28, "relative_strength": 0.85 },
                    { "sector": "Health Care", "market_weight": 0.14, "relative_strength": 0.40 },
                    { "sector": "Financials", "market_weight": 0.12, "relative_strength": -0.20 },
                    { "sector": "Consumer Discretionary", "market_weight": 0.10, "relative_strength": -0.75 },
                    { "sector": "Communication Services", "market_weight": 0.09, "relative_strength": 0.65 },
                    { "sector": "Industrials", "market_weight": 0.08, "relative_strength": 0.15 },
                    { "sector": "Consumer Staples", "market_weight": 0.06, "relative_strength": -0.50 },
                    { "sector": "Energy", "market_weight": 0.05, "relative_strength": 0.95 },
                    { "sector": "Utilities", "market_weight": 0.03, "relative_strength": -0.90 },
                    { "sector": "Real Estate", "market_weight": 0.03, "relative_strength": -0.60 },
                    { "sector": "Materials", "market_weight": 0.02, "relative_strength": 0.10 }
                ];

                // --- Data Preparation ---

                // Function to add line breaks to long labels for better wrapping
                const formatLabel = (label) => {
                    const words = label.split(' ');
                    if (words.length > 1) {
                        return words.join('<br>');
                    }
                    return label;
                };

                const labels = sectorData.map(d => formatLabel(d.sector));
                const parents = sectorData.map(() => "Sectors");
                const values = sectorData.map(d => d.market_weight);
                const markerColors = sectorData.map(d => d.relative_strength);

                // --- Chart Configuration ---

                const data = [{
                    type: "treemap",
                    labels: labels,
                    parents: parents,
                    values: values,
                    customdata: sectorData.map(d => ({
                        strength: d.relative_strength,
                        weight: d.market_weight
                    })),
                    hovertemplate: '<b>%{label}</b><br>' +
                                   'Market Weight: %{customdata.weight:.2%}<br>' +
                                   'Relative Strength: %{customdata.strength:.2f}' +
                                   '<extra></extra>',
                    textinfo: "label",
                    textfont: {
                        family: 'Inter, sans-serif',
                        size: 14,
                        color: '#f3f4f6' // Use light text for all tiles
                    },
                    marker: {
                        colors: markerColors,
                        // A diverging colorscale from Red -> Gray -> Green
                        colorscale: [
                            [0.0, 'rgb(220, 38, 38)'],   // Strong Red for losses
                            [0.5, 'rgb(75, 85, 99)'],    // Neutral Gray for no change
                            [1.0, 'rgb(34, 197, 94)']  // Strong Green for gains
                        ],
                        cmin: -1.0,
                        cmax: 1.0,
                        line: {
                            color: '#374151',
                            width: 2
                        }
                    },
                    pathbar: { visible: false }
                }];

                const layout = {
                    paper_bgcolor: '#111827',
                    plot_bgcolor: '#111827',
                    margin: { l: 5, r: 5, b: 5, t: 5 }, // Reduced margins for more chart space
                    font: {
                        family: 'Inter, sans-serif',
                        color: '#d1d5db'
                    }
                };

                const config = {
                    responsive: true,
                    displayModeBar: false
                };

                Plotly.newPlot('sector-treemap', data, layout, config);

            } catch (error) {
                console.error("Failed to process chart data:", error);
                const chartDiv = document.getElementById('sector-treemap');
                chartDiv.innerHTML = `<div class="flex items-center justify-center h-full text-red-400 p-4 text-center">
                                        <p>Error: Could not load chart data. Please check the console for details.</p>
                                      </div>`;
            }
        }

        // Call the function to create the chart when the page loads
        document.addEventListener('DOMContentLoaded', createTreemap);

        // Set dynamic copyright year
        document.getElementById('copyright').innerHTML = `&copy; ${new Date().getFullYear()} KaChing Labs. All Rights Reserved.`;

    </script>
</body>
</html>
