<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sector Rotation Radar</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Plotly.js for charting (updated version) -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(to right, #10B981, #3B82F6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Ensure the Plotly chart tooltip has a dark background */
        .plotly .hovertext {
            background-color: #1f2937 !important; /* bg-gray-800 */
            border-color: #4b5563 !important; /* border-gray-600 */
        }
        /* Styles for the AI content */
        .ai-content p, .ai-content br {
            margin-bottom: 0.75rem;
        }
        .ai-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .ai-content strong {
            color: #d1d5db; /* gray-300 */
        }
        /* Remove cursor pointer from non-interactive list */
        .sector-row {
            cursor: default;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <main class="container mx-auto px-4 sm:px-6 py-8">
        <!-- Header Section -->
        <section id="header" class="pb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">
                U.S. Market Sectors
            </h1>
            <p class="mt-2 text-base sm:text-lg text-gray-400">
                Performance overview of S&P 500 sectors. Click a sector on the treemap for AI insights.
            </p>
        </section>

        <!-- Main Content: Two-column layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-stretch">

            <!-- Left Column: Sector List -->
            <div id="sector-list-container" class="lg:col-span-1 bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2">Sector Performance</h2>
                <div id="sector-list" class="space-y-1">
                    <!-- Sector list will be dynamically generated here -->
                </div>
            </div>

            <!-- Right Column: Treemap Chart / Insights -->
            <div id="right-column-container" class="lg:col-span-2 bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col">
                 <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-4">
                    <h2 id="right-column-title" class="text-xl font-bold text-white">âœ¨ Sector Treemap</h2>
                    <button id="back-to-treemap-btn" class="hidden text-sm text-blue-400 hover:text-blue-300">&larr; Back to Treemap</button>
                </div>
                <div class="flex-grow min-h-[50vh] lg:min-h-0">
                    <div id="sector-treemap" class="w-full h-full"></div>
                    <div id="sector-insights-output" class="hidden w-full h-full text-gray-300 leading-relaxed ai-content overflow-y-auto"></div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 mt-8">
        <div class="container mx-auto px-6 py-8 text-center text-gray-400">
            <a href="https://KaChing-Labs.com" class="text-lg font-semibold text-white">KaChing <span class="text-emerald-400">Labs</span></a>
            <p class="mt-2 text-sm">Intelligent tools for your financial journey.</p>
            <p id="copyright" class="mt-4 text-xs">&copy; 2025 KaChing Labs. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // --- Page Generation ---

        // Mock Data - This simulates the data.json file that your backend will generate.
        const marketData = {
            "sectors": [
                { "sector": "Information Technology", "market_weight": 0.28, "change_pct": 1.25, "insights": "<strong>Positive Momentum:</strong> The tech sector's gain of 1.25% reflects ongoing investor confidence. This could be tied to strong earnings forecasts and breakthroughs in AI technology.<br><strong>Key Companies:</strong> Apple (AAPL), Microsoft (MSFT), Nvidia (NVDA).<br><strong>Outlook:</strong> Bullish." },
                { "sector": "Health Care", "market_weight": 0.14, "change_pct": 0.40, "insights": "<strong>Steady Gains:</strong> Health Care saw a modest gain. This defensive sector often performs well in uncertain markets. Positive clinical trial news from a major pharmaceutical company may have contributed.<br><strong>Key Companies:</strong> Johnson & Johnson (JNJ), UnitedHealth Group (UNH), Pfizer (PFE).<br><strong>Outlook:</strong> Neutral to Bullish." },
                { "sector": "Financials", "market_weight": 0.12, "change_pct": -0.20, "insights": "<strong>Slight Downturn:</strong> Financials experienced a minor dip. This could be due to uncertainty regarding future interest rate decisions by the Federal Reserve.<br><strong>Key Companies:</strong> JPMorgan Chase (JPM), Berkshire Hathaway (BRK.B), Bank of America (BAC).<br><strong>Outlook:</strong> Neutral." },
                { "sector": "Consumer Discretionary", "market_weight": 0.10, "change_pct": -1.75, "insights": "<strong>Significant Drop:</strong> This sector's sharp decline of 1.75% suggests worries about consumer spending power, possibly linked to recent inflation data or a drop in consumer confidence.<br><strong>Key Companies:</strong> Amazon (AMZN), Tesla (TSLA), Home Depot (HD).<br><strong>Outlook:</strong> Bearish." },
                { "sector": "Communication Services", "market_weight": 0.09, "change_pct": 0.95, "insights": "<strong>Strong Performance:</strong> A solid gain for Communication Services, likely driven by strong performance from major streaming and social media platforms.<br><strong>Key Companies:</strong> Alphabet (GOOGL), Meta Platforms (META), Netflix (NFLX).<br><strong>Outlook:</strong> Bullish." },
                { "sector": "Industrials", "market_weight": 0.08, "change_pct": 0.15, "insights": "<strong>Modest Gains:</strong> The Industrials sector saw a slight uptick, possibly due to positive manufacturing data or government infrastructure spending announcements.<br><strong>Key Companies:</strong> Caterpillar (CAT), Boeing (BA), Union Pacific (UNP).<br><strong>Outlook:</strong> Neutral." },
                { "sector": "Consumer Staples", "market_weight": 0.06, "change_pct": -0.50, "insights": "<strong>Defensive Dip:</strong> A slight loss for this defensive sector. Investors may be rotating into higher-growth areas like Tech and Energy.<br><strong>Key Companies:</strong> Procter & Gamble (PG), Coca-Cola (KO), Walmart (WMT).<br><strong>Outlook:</strong> Neutral to Bearish." },
                { "sector": "Energy", "market_weight": 0.05, "change_pct": 2.10, "insights": "<strong>Top Performer:</strong> The Energy sector led the market with a strong 2.10% gain. This is almost certainly tied to a recent surge in global oil prices and geopolitical tensions.<br><strong>Key Companies:</strong> Exxon Mobil (XOM), Chevron (CVX), ConocoPhillips (COP).<br><strong>Outlook:</strong> Bullish." },
                { "sector": "Utilities", "market_weight": 0.03, "change_pct": -0.90, "insights": "<strong>Underperforming:</strong> Utilities, a typically stable sector, saw a notable decline. This can happen when interest rates are expected to rise, making their dividends less attractive.<br><strong>Key Companies:</strong> NextEra Energy (NEE), Duke Energy (DUK), Southern Company (SO).<br><strong>Outlook:</strong> Bearish." },
                { "sector": "Real Estate", "market_weight": 0.03, "change_pct": -1.10, "insights": "<strong>Interest Rate Sensitivity:</strong> The decline in Real Estate is likely a direct response to fears of rising interest rates, which increases borrowing costs and can cool the housing market.<br><strong>Key Companies:</strong> American Tower (AMT), Prologis (PLD), Crown Castle (CCI).<br><strong>Outlook:</strong> Bearish." },
                { "sector": "Materials", "market_weight": 0.02, "change_pct": 0.05, "insights": "<strong>Flat Performance:</strong> The Materials sector was nearly unchanged. This suggests a balance between demand from construction and industrial activity and concerns about a potential economic slowdown.<br><strong>Key Companies:</strong> Linde (LIN), Sherwin-Williams (SHW), DuPont (DD).<br><strong>Outlook:</strong> Neutral." }
            ]
        };

        function generatePage() {
            try {
                const sectorData = marketData.sectors;

                // --- Generate Sector List (Left Column) ---
                const sectorList = document.getElementById('sector-list');
                let listHtml = '';

                sectorData.sort((a, b) => b.market_weight - a.market_weight);

                sectorData.forEach(item => {
                    const sectorId = item.sector.toLowerCase().replace(/ /g, '-');
                    const isPositive = item.change_pct >= 0;
                    const colorClass = isPositive ? 'text-green-400' : 'text-red-400';
                    const sign = isPositive ? '+' : '';
                    const formattedChange = `${sign}${item.change_pct.toFixed(2)}%`;

                    listHtml += `
                        <div class="sector-row flex justify-between items-center p-2 rounded-md">
                            <span class="font-medium text-sm sm:text-base text-gray-300">${item.sector}</span>
                            <span id="perf-${sectorId}" class="font-bold text-base sm:text-lg ${colorClass}">${formattedChange}</span>
                        </div>
                    `;
                });
                sectorList.innerHTML = listHtml;


                // --- Generate Treemap Chart (Right Column) ---
                const treemapDiv = document.getElementById('sector-treemap');
                const formatLabel = (label) => label.replace(/ /g, '<br>');

                const labels = sectorData.map(d => formatLabel(d.sector));
                const parents = sectorData.map(() => "Sectors");
                const values = sectorData.map(d => d.market_weight);
                const markerColors = sectorData.map(d => d.change_pct);

                const data = [{
                    type: "treemap",
                    labels: labels,
                    parents: parents,
                    values: values,
                    customdata: sectorData.map(d => ({ change: d.change_pct, weight: d.market_weight, originalLabel: d.sector })),
                    hovertemplate: '<b>%{customdata.originalLabel}</b><br>Market Weight: %{value:.2%}<br>Change: %{customdata.change:+.2f}%<extra></extra>',
                    textinfo: "label",
                    textfont: { family: 'Inter, sans-serif', size: 14, color: '#f3f4f6' },
                    marker: {
                        colors: markerColors,
                        colorscale: [
                            [0.0, 'rgb(200, 50, 50)'], [0.5, 'rgb(100, 100, 100)'], [1.0, 'rgb(50, 200, 50)']
                        ],
                        cmin: -2.5, cmax: 2.5,
                        line: { color: '#1f2937', width: 2 }
                    },
                    pathbar: { visible: false }
                }];

                const layout = {
                    paper_bgcolor: 'transparent', plot_bgcolor: 'transparent',
                    margin: { l: 5, r: 5, b: 5, t: 5 },
                    font: { family: 'Inter, sans-serif', color: '#d1d5db' }
                };

                const config = { responsive: true, displayModeBar: false };
                Plotly.newPlot(treemapDiv, data, layout, config);

                // --- Setup Event Listeners ---
                setupEventListeners(treemapDiv);

            } catch (error) {
                console.error("Failed to generate page:", error);
                document.body.innerHTML = `<div class="flex items-center justify-center h-screen text-red-400 p-4 text-center"><p>Error: Could not load page content. Please check the console.</p></div>`;
            }
        }

        const rightColumnTitle = document.getElementById('right-column-title');
        const treemapDiv = document.getElementById('sector-treemap');
        const insightsOutput = document.getElementById('sector-insights-output');
        const backBtn = document.getElementById('back-to-treemap-btn');

        function showTreemap() {
            rightColumnTitle.textContent = 'âœ¨ Sector Treemap';
            insightsOutput.classList.add('hidden');
            treemapDiv.classList.remove('hidden');
            backBtn.classList.add('hidden');
            Plotly.Plots.resize(treemapDiv);
        }

        function showSectorInsights(sectorName) {
            const sectorInfo = marketData.sectors.find(s => s.sector === sectorName);
            if (sectorInfo) {
                rightColumnTitle.textContent = `âœ¨ ${sectorName} Insights`;
                insightsOutput.innerHTML = sectorInfo.insights;
                treemapDiv.classList.add('hidden');
                insightsOutput.classList.remove('hidden');
                backBtn.classList.remove('hidden');
            }
        }

        function setupEventListeners(chartDiv) {
            // Treemap Click Listener
            chartDiv.on('plotly_click', data => {
                if (data.points.length > 0) {
                    // Use the original label from customdata for accuracy
                    const sectorName = data.points[0].customdata.originalLabel;
                    showSectorInsights(sectorName);
                }
            });

            // Back to Treemap Button
            backBtn.addEventListener('click', showTreemap);
        }

        // --- Initial Page Load ---
        document.addEventListener('DOMContentLoaded', generatePage);

        // Set dynamic copyright year
        document.getElementById('copyright').innerHTML = `&copy; ${new Date().getFullYear()} KaChing Labs. All Rights Reserved.`;

    </script>
</body>
</html>
